(this["webpackJsonpdelivery-crm"]=this["webpackJsonpdelivery-crm"]||[]).push([[41],{599:function(e,t,n){"use strict";n.r(t);var a=n(27),r=n(2),c=n(0),s=n.n(c),o=n(170),i=n.n(o),d=n(491),u=n.n(d);function l(e){var t=e.records,n=e.onSetIndex,a={xAxis:{categories:t.map((function(e){return e.date})),title:{text:"Date"},crosshair:!0},title:{text:"Customer Inactivity Trend"},boost:{useGPUTranslations:!0},chart:{zoomType:"x",panning:!0,panKey:"shift"},yAxis:[{title:{text:"Cumulative Inactive Count"}},{gridLineWidth:0,opposite:!0,title:{text:"New Inactive Count"}}],series:[{name:"Cumulative Inactive Count",data:t.map((function(e){return e.inactiveCustomers})),yAxis:0},{name:"New Inactive Count",type:"column",data:t.map((function(e){return e.newInactive})),yAxis:1,events:{click:function(e){n(e.point.index)}}}],tooltip:{shared:!0}};return Object(r.jsx)("div",{children:Object(r.jsx)(u.a,{config:a})})}var m=s.a.memo(l),v=n(196),b=n.n(v),j=[{name:"id",selector:"id",sortable:!0},{name:"Name",selector:"name",sortable:!0,cell:function(e){var t=e.id,n=e.name;return Object(r.jsx)("a",{href:"https://gaudugdham.milkmanapps.com/subscriptions?id=".concat(btoa(t)),target:"_blank",rel:"noreferrer",children:n})}},{name:"Phone",selector:"phone_number",sortable:!0,cell:function(e){var t=e.phone_number;return Object(r.jsx)("a",{href:"tel:+91".concat(t),className:"flex middle",children:t})}},{name:"Total Orders",selector:"orders_count",sortable:!0},{name:"Wallet",selector:"wallet_balance",sortable:!0}];for(var f=function(e){var t=e.customers;return Object(r.jsx)("div",{children:Object(r.jsx)(b.a,{noHeader:!0,dense:!0,data:t,columns:j})})},h=n(213),O=365,x=[],p=i()().subtract(O,"days"),I=0;I<O;I++){var w=p.clone().add(I,"days").format("YYYY-MM-DD");x.push({date:w,inactiveCustomers:0,newActiveCustomerIds:[]})}t.default=function(){var e=Object(c.useState)([]),t=Object(a.a)(e,2),n=t[0],s=t[1],o=Object(c.useState)([]),d=Object(a.a)(o,2),u=d[0],l=d[1],v=Object(c.useState)(0),b=Object(a.a)(v,2),j=b[0],p=b[1];Object(c.useEffect)((function(){Object(h.d)().then((function(e){var t=e.data;t=(t=t.filter((function(e){return e.totalOrders>1}))).sort((function(e,t){return new Date(e.lastOrderDate)-new Date(t.lastOrderDate)}));for(var n=0,a=0;n<O&&a<t.length;){var r=0;for(x[n].newActiveCustomerIds=[];a<t.length&&i()(t[a].lastOrderDate).add(15,"d")<i()(x[n].date);)a++,r++,x[n].newActiveCustomerIds.push(t[a].customerId);x[n].inactiveCustomers=Number(a),x[n].newInactive=r,n++}x[0].newInactive=0,s(t),p(364)}))}),[]),Object(c.useEffect)((function(){var e=x[j].newActiveCustomerIds,t={ids:void 0===e?[]:e};Object(h.c)(t).then((function(e){var t=e.data;l(t)}))}),[j]);var I=x[j],w=I.newActiveCustomerIds,C=void 0===w?[]:w,g=I.date;return console.log(C,x[j]),console.log(u),Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{children:Object(r.jsx)(m,{data:n,records:x,onSetIndex:p})}),Object(r.jsxs)("div",{children:[Object(r.jsxs)("h3",{className:"p-10",children:["New Inactive on ",i()(g).format("DD-MM-YYYY")," (",C.length,")"]}),Object(r.jsx)(f,{customers:u||[]})]})]})}}}]);