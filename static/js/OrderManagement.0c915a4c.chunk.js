(this["webpackJsonpdelivery-crm"]=this["webpackJsonpdelivery-crm"]||[]).push([[15],{190:function(e,t,r){"use strict";r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return l})),r.d(t,"b",(function(){return s})),r.d(t,"i",(function(){return u})),r.d(t,"h",(function(){return h})),r.d(t,"g",(function(){return v})),r.d(t,"f",(function(){return b})),r.d(t,"a",(function(){return j})),r.d(t,"c",(function(){return f}));var n=r(33),a=r(185),c=r.n(a),o=r(28),i=r.n(o);function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c()().format("YYYY-MM-DD"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c()().format("YYYY-MM-DD"),r="".concat(n.a,"/v2/order/getAllOrders?fromDate=").concat(e,"&endDate=").concat(t);return Object(n.d)(r)}function l(){var e="".concat(n.a,"/v2/order/getDeliveryBoysData");return Object(n.d)(e)}function s(e){var t="".concat(n.a,"/v2/order/assignDrivers");return Object(n.f)(t,e)}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c()().format("YYYY-MM-DD"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c()().format("YYYY-MM-DD"),r="".concat(n.a,"/v2/order/getOrderedProducts?fromDate=").concat(e,"&endDate=").concat(t);return Object(n.d)(r)}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c()().format("YYYY-MM-DD"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c()().format("YYYY-MM-DD"),r="".concat(n.a,"/v2/order/getOrderProducts?fromDate=").concat(e,"&endDate=").concat(t);return Object(n.d)(r)}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c()().format("YYYY-MM-DD"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c()().format("YYYY-MM-DD"),r="".concat(n.a,"/v2/order/getOrderBoxData?fromDate=").concat(e,"&endDate=").concat(t);return Object(n.d)(r)}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c()().format("YYYY-MM-DD"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c()().format("YYYY-MM-DD"),r="".concat(n.a,"/v2/order/getDeliveryReport?fromDate=").concat(e,"&endDate=").concat(t);return Object(n.d)(r)}function j(e){var t="".concat(n.a,"/delivery/addDeliveryPerson");return i.a.put(t,e,{headers:{"Content-Type":"application/json"}})}function f(){var e="".concat(n.a,"/farmers/getAllFarmers");return Object(n.d)(e)}},205:function(e,t,r){"use strict";t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"export.csv",r=document.createElement("a"),n=[];e.forEach((function(e){e=e.join(","),n.push(e)}));var a=n.join("\n");null!=a&&(a.match(/^data:text\/csv/i)||(a="data:text/csv;charset=utf-8,".concat(a)),r.setAttribute("href",encodeURI(a)),r.setAttribute("download",t),r.click())}},319:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return a}));var n=[1,2,3,23],a=[4,811,877]},974:function(e,t,r){"use strict";r.r(t);var n=r(177),a=r.n(n),c=r(178),o=r(153),i=r(154),d=r(156),l=r(157),s=r(5),u=r(2),h=r(0),v=r.n(h),b=r(51),j=r(971),f=r(996),p=r(318),m=r(954),O=r(955),g=r(993),x=r(205),D=r(972),y=r(52),w=r(27),Y=r(943),C=r(206),I=r.n(C),S=r(222),k=r.n(S),A=r(1),M=r(3),B=(r(8),r(10)),P=r(171),R=r(183),E=Object(R.a)(h.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),z=Object(R.a)(h.createElement("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),H=r(34),N=Object(R.a)(h.createElement("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox"),L=r(24),U=r(18),T=h.createElement(z,null),V=h.createElement(E,null),$=h.createElement(N,null),F=h.forwardRef((function(e,t){var r=e.checkedIcon,n=void 0===r?T:r,a=e.classes,c=e.color,o=void 0===c?"secondary":c,i=e.icon,d=void 0===i?V:i,l=e.indeterminate,s=void 0!==l&&l,u=e.indeterminateIcon,v=void 0===u?$:u,b=e.inputProps,j=e.size,f=void 0===j?"medium":j,p=Object(M.a)(e,["checkedIcon","classes","color","icon","indeterminate","indeterminateIcon","inputProps","size"]),m=s?v:d,O=s?v:n;return h.createElement(P.a,Object(A.a)({type:"checkbox",classes:{root:Object(B.a)(a.root,a["color".concat(Object(L.a)(o))],s&&a.indeterminate),checked:a.checked,disabled:a.disabled},color:o,inputProps:Object(A.a)({"data-indeterminate":s},b),icon:h.cloneElement(m,{fontSize:void 0===m.props.fontSize&&"small"===f?f:m.props.fontSize}),checkedIcon:h.cloneElement(O,{fontSize:void 0===O.props.fontSize&&"small"===f?f:O.props.fontSize}),ref:t},p))})),Q=Object(U.a)((function(e){return{root:{color:e.palette.text.secondary},checked:{},disabled:{},indeterminate:{},colorPrimary:{"&$checked":{color:e.palette.primary.main,"&:hover":{backgroundColor:Object(H.c)(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:e.palette.action.disabled}},colorSecondary:{"&$checked":{color:e.palette.secondary.main,"&:hover":{backgroundColor:Object(H.c)(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:e.palette.action.disabled}}}}),{name:"MuiCheckbox"})(F),J=r(197),W=r.n(J),_=Object(u.jsx)(W.a,{});function q(e){var t=e.data,r=(e.onRowSelect,e.onSelectionChange),n=e.deliveryBoys,a=e.orderBoxData,c=[{name:"Area",sortable:!0,selector:"area",width:"140px"},{name:"Locality",sortable:!0,selector:"subarea",width:"200px"},{name:"Driver",selector:"_driver",cell:function(e,t){var r=e.driverId;if(r){var a=n.get(r);return a?a.name:""}return""}},{name:"Order Id",selector:"orderId",sortable:!0,width:"130px"},{name:"Crate Id",selector:"orderId",sortable:!0,width:"120px",cell:function(e){var t=e.orderId,r=a.get(parseInt(t));return null===r||void 0===r?void 0:r.crateId}},{name:"Name",selector:"name",sortable:!0,width:"200px"},{name:"Phone",selector:"phone",sortable:!0,width:"140px"},{name:"Hub",sortable:!0,selector:"region",width:"100px"}];return Object(u.jsx)("div",{children:Object(u.jsx)(k.a,{striped:!0,noHeader:!0,selectableRows:!0,onSelectedRowsChange:r,dense:!0,selectableRowsComponent:Q,sortIcon:_,data:t,columns:c,highlightOnHover:!0,pointerOnHover:!0,pagination:!0,paginationPerPage:35,paginationRowsPerPageOptions:[10,35,100,t.length]})})}var G=v.a.memo(q),Z=r(190),K=r(203);var X=Object(b.b)((function(e){var t=e.setAdmin;return Object(s.a)({},t)}),(function(e){return{onUpdateOrdersData:function(t){return e(Object(K.h)(t))}}}))((function(e){var t=e.data,r=e.deliveryBoys,n=e.onUpdateOrdersData,a=e.orderBoxData,c=Array.from(r.values());c=c.sort((function(e,t){return e.name.localeCompare(t.name)}));var o=Object(h.useState)([]),i=Object(w.a)(o,2),d=i[0],l=i[1],s=Object(h.useState)(!1),v=Object(w.a)(s,2),b=(v[0],v[1]),g=Object(h.useState)(""),x=Object(w.a)(g,2),D=x[0],y=x[1],C=Object(h.useCallback)((function(e){b(e)}),[]),S=Object(h.useCallback)((function(e){e.allSelected,e.selectedCount;var t=e.selectedRows;l(t)}),[]);return Object(u.jsxs)("div",{id:"assign-orders",children:[Object(u.jsx)(Y.a,{}),Object(u.jsx)("div",{className:"flex space-bw middle p-10",children:Object(u.jsxs)("div",{className:"flex right middle",children:[Object(u.jsxs)(m.a,{size:"small",children:[Object(u.jsx)(f.a,{id:"driver-filter",children:"Select Driver"}),Object(u.jsxs)(j.a,{labelId:"driver-filter",style:{width:200},disabled:d.length<1,value:D,onChange:function(e){var t={order_ids:d.map((function(e){return e.orderId})),driver:e.target.value};Object(Z.b)(t).then((function(e){Object(Z.d)().then((function(e){var t=e.data;y(""),n(t)})),l([])}))},children:[Object(u.jsx)(p.a,{value:"",children:"None"}),c.map((function(e){return Object(u.jsx)(p.a,{value:e.id,children:e.name},"driver-".concat(e.id))}))]})]}),Object(u.jsxs)("div",{className:"p-10",children:[t.length," Customers Filtered"]}),Object(u.jsxs)("div",{className:"p-10",children:[d.length," Customers Selected"]}),Object(u.jsx)("div",{className:"p-10",children:Object(u.jsx)(O.a,{startIcon:Object(u.jsx)(I.a,{}),color:"secondary",variant:"outlined",onClick:e.exportData,children:"Download Excel"})})]})}),Object(u.jsx)(G,{data:t,orderBoxData:a,onSelectionChange:S,onRowSelect:C,deliveryBoys:r})]})})),ee=r(319);var te=function(e){Object(d.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).update=Object(c.a)(a.a.mark((function e(){var t,r,c,o,i,d,l,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n.setState({loading:!0}),t=n.props,r=t.onUpdateOrdersData,c=t.onUpdateAdminData,e.next=5,Object(Z.e)().then((function(e){return e.data}));case 5:return o=e.sent,i=new Map,o.forEach((function(e){i.set(e.id,e)})),c({deliveryBoys:i}),e.next=11,Object(Z.d)().then((function(e){return e.data}));case 11:return d=e.sent,r(d),e.next=15,Object(Z.h)().then((function(e){return e.data}));case 15:return l=e.sent,n.props.onAddOrderProducts(l),e.next=19,Object(Z.i)().then((function(e){return e.data}));case 19:return s=e.sent,n.props.onAddProducts(s),e.next=23,Object(Z.g)().then((function(e){return e.data}));case 23:u=e.sent,n.props.onAddOrderBox(u),n.setState({loading:!1}),e.next=31;break;case 28:e.prev=28,e.t0=e.catch(0),n.setState({error:e.t0.message});case 31:case"end":return e.stop()}}),e,null,[[0,28]])}))),n.componentDidMount=Object(c.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.update();case 2:case"end":return e.stop()}}),e)}))),n.hideAddress=function(){return n.setState({hiddenAddress:!0})},n.exportData=function(){for(var e=n.props,t=e.deliveryBoys,r=e.orderBoxData,a=e.orderProducts,c=[["S.No.","Order Id","Crate Id","Customer Id","Name","Phone","Region","Area","Locality","House","Driver","Type","Qty"]],o=n.filterData(),i=0;i<o.length;i++){var d=o[i],l=d.driverId,s="";l&&(s=t.get(l).name);var u=d.customerID,h=d.orderId,v=d.name,b=d.phone,j=d.region,f=d.area,p=d.subarea,m=d.address,O=r.get(parseInt(h)),g=a.get(parseInt(h)),D=[i+1,h,null===O||void 0===O?void 0:O.crateId,u,'"'.concat(v,'"'),b,'"'.concat(j,'"'),'"'.concat(f,'"'),'"'.concat(p,'"'),'"'.concat(m.replace(/[^0-9a-zA-Z:/ ]/g,""),'"'),'"'.concat(s,'"')],y=0,w=0;g?(g.forEach((function(e){var t=e.productId,r=e.qty;ee.b.includes(t)?y+=r:ee.a.includes(t)&&(w+=r)})),y&&c.push([].concat(D,["Pouch Milk",y])),w&&c.push([].concat(D,["Gable Top",w]))):alert("Something wrong with data uploaded for order",h);var Y=O||{},C=Y.largeBox,I=Y.mediumBox,S=Y.packet;C&&c.push([].concat(D,["Large Box",C])),I&&c.push([].concat(D,["Medium Box",I])),S&&c.push([].concat(D,["Packet",S])),w||y||C||I||S?console.log("Already Loaded Customer in the sheet"):(console.log("This is not ideal. Maybe the packing is not over yet.\nAn order should have atleast one of gableTopQty || pouchMilkQty || largeBox || mediumBox || packet "),c.push([].concat(D,["Complete",""])))}Object(x.a)(c,"Delivery Sheet - ".concat((new Date).toLocaleDateString(),".csv"))},n.state={loading:!0,phone:"",selectedArea:[],selectedSubarea:[],selectedHub:[],selectedDriver:"all",showWithoutDairy:!1,hiddenAddress:!1,selectedRow:[]},n}return Object(i.a)(r,[{key:"filterData",value:function(){var e=this.state,t=e.selectedSubarea,r=e.selectedArea,n=e.selectedHub,a=e.selectedDriver,c=e.phone,o=this.props.orders,i=[];return o&&(i=o.filter((function(e){if(n.length&&e.region!==n)return!1;if(r.length&&!r.includes(e.area))return!1;if(t.length&&!t.includes(e.subarea))return!1;if("all"!==a)if("none"===a){if(null!==e.driverId)return!1}else if(e.driverId!==a)return!1;return!c||(-1!==e.phone.indexOf(c)||(-1!==e.name.toLowerCase().indexOf(c.toLowerCase())||-1!==e.orderId.toString().indexOf(c.toLowerCase())))}))),i}},{key:"render",value:function(){var e=this,t=this.state,r=t.selectedArea,n=t.selectedHub,a=t.selectedDriver,c=t.phone,o=t.loading,i=void 0===o||o,d=this.props,l=d.locations,h=d.hubs,v=d.deliveryBoys,b=d.orders,x=d.orderBoxData,w=v?Array.from(v.values()):[];w=w.sort((function(e,t){return e.name.localeCompare(t.name)}));var Y=[],C=[];l&&l.forEach((function(e,t){e.forEach((function(e,a){t!==n&&0!==n.length||Y.push(a),(r.includes(a)||0===r.length)&&(C=C.concat(e))}))})),Y=Y.sort((function(e,t){return e.localeCompare(t)})),b&&v&&x&&(i=!1);var I=this.filterData();return Object(u.jsx)("div",{children:i?Object(u.jsx)(y.a,{}):Object(u.jsxs)("div",{children:[Object(u.jsxs)("div",{className:"flex middle",style:{padding:10},children:[Object(u.jsx)("div",{style:{marginRight:20,width:220},children:Object(u.jsx)(g.a,{value:c,fullWidth:!0,label:"Phone, Name, Crate, Order Id",onChange:function(t){return e.setState({phone:t.target.value})}})}),Object(u.jsx)("div",{style:{marginRight:20,width:120},children:Object(u.jsxs)(m.a,{children:[Object(u.jsx)(f.a,{id:"hub-filter",children:"Hub"}),Object(u.jsx)(j.a,{labelId:"hub-filter",style:{width:100},value:n,onChange:function(t){var r=t.target.value;e.setState({selectedHub:r,selectedArea:[],selectedSubarea:[]})},children:h.map((function(e){return Object(u.jsx)(p.a,{value:e,children:e},e)}))})]})}),Object(u.jsx)("div",{style:{marginRight:20,width:300},children:Object(u.jsx)(m.a,{style:{width:"100%"},children:Object(u.jsx)(D.a,{options:Y,multiple:!0,renderInput:function(e){return Object(u.jsx)(g.a,Object(s.a)(Object(s.a)({},e),{},{label:"Area"}))},onChange:function(t,r){e.setState({selectedArea:r,selectedSubarea:[]})}})})}),Object(u.jsx)("div",{style:{marginRight:20,width:400},children:Object(u.jsx)(m.a,{style:{width:"100%"},children:Object(u.jsx)(D.a,{options:C,multiple:!0,renderInput:function(e){return Object(u.jsx)(g.a,Object(s.a)(Object(s.a)({},e),{},{label:"Locality"}))},onChange:function(t,r){e.setState({selectedSubarea:r})}})})}),Object(u.jsx)("div",{style:{marginRight:20},children:Object(u.jsxs)(m.a,{children:[Object(u.jsx)(f.a,{id:"driver-filter",children:"Assigned Driver"}),Object(u.jsxs)(j.a,{labelId:"driver-filter",style:{width:200},value:a||"all",onChange:function(t,r){var n=t.target.value;e.setState({selectedDriver:n})},children:[Object(u.jsx)(p.a,{value:"all",children:"All"}),Object(u.jsx)(p.a,{value:"none",children:"None"}),w.map((function(e){return Object(u.jsx)(p.a,{value:e.id,children:e.name},"driver-".concat(e.id))}))]})]})}),Object(u.jsx)("div",{style:{marginRight:20},children:Object(u.jsx)(O.a,{color:"default",variant:"outlined",onClick:function(){window.location.reload()},children:"Remove Filters"})})]}),Object(u.jsx)(X,{data:I,exportData:this.exportData,deliveryBoys:v})]})})}}]),r}(h.Component);t.default=Object(b.b)((function(e){var t=e.setAdmin;return Object(s.a)({},t)}),(function(e){return{onUpdateOrdersData:function(t){return e(Object(K.h)(t))},onUpdateAdminData:function(t){return e(Object(K.e)(t))},onAddProducts:function(t){return e(Object(K.c)(t))},onAddOrderProducts:function(t){return e(Object(K.b)(t))},onAddOrderBox:function(t){return e(Object(K.a)(t))}}}))(te)}}]);